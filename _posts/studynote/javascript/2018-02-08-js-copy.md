---
layout: post
title: "javascript - 深拷贝和浅拷贝 "
data: 2018-02-02 12:27:00 +0800
categories: 学习笔记
tag: javascript
---

* content
{:toc}

* 参考资料
    + [深入剖析 JavaScript 的深复制](http://jerryzou.com/posts/dive-into-deep-clone-in-javascript/)
    + [javascript中的深拷贝和浅拷贝？](https://www.zhihu.com/question/23031215)

<!-- more -->

## 一、什么是浅拷贝和深拷贝

> * 浅拷贝：
>   * 浅拷贝就是指对象地址的复制，并没有开辟新的栈，即：复制的结果是原对象与浅拷贝的对象指向同一个地址。
>   * 修改其中一个对象的属性，另外一个对象的这个属性也会跟随着改变

> * 深拷贝：
>   * 深拷贝就是值开辟了新的栈，原对象与深拷贝的对象不是指向同一个地址。
>   * 修改一个对象的属性，另外一个对象并不会随之发生改变

## 二、浅拷贝的实现

> * [demo](/effects/demo/js/copy/shallowCopy/v1.html)

```js
  let oObj = {
      name: 'jm',
      age: 18,
      hobbies: ['打篮球', '游泳'],
      friend: {
        name: 'lili',
        age: 18
      }
    }

    // 浅拷贝，一变全变
    let copy = oObj
    copy.hobbies.push('跳舞')
    console.log(oObj)
    console.log(copy)
```

## 三、深拷贝的实现

### 3.1 递归实现

> * [demo](/effects/demo/js/copy/deepCopy/v1.html)

```js
    let oObj = {
      name: 'jm',
      age: 18,
      hobbies: ['打篮球', '游泳'],
      friend: {
        name: 'lili',
        age: 18
      }
    }

    let cObj = {
      workPlace: ['佛山', '广州']
    }

    // 测试是否已成功深拷贝
    const result = deepCopy(oObj, cObj)
    result.hobbies.push('学习')
    console.log(result)
    console.log(oObj)

    /**
     * 深拷贝（递归实现）- 将原对象复制到目标对象上
     * @param originObj 原对象
     * @param copyObj 目标对象
     * @return {*|{}}
     */
    function deepCopy (originObj, targetObj) {
        let cObj = targetObj || {}
        for (var i in originObj) {
          const item = originObj[i]
          // 引用类型
          if (typeof item === 'object') {
            // 对象
            if (Object.prototype.toString.call(item) === '[object Object]') {
              cObj[i] = {}
            }
            // 数组
            else if (Object.prototype.toString.call(item) === '[object Array]') {
              cObj[i] = []
            }
            // 递归
            deepCopy(originObj[i], cObj[i])
          }
          // 基本类型
          else {
            cObj[i] = item
          }
        }
        return cObj
    }
```

![deepCopy](/styles/images/javascript/copy/copy-01.png)

### 3.1 通过JSON解析解决

> * [demo](/effects/demo/js/copy/deepCopy/v2.html)

```js
    let oObj = {
      name: 'jm',
      age: 18,
      hobbies: ['打篮球', '游泳'],
      friend: {
        name: 'lili',
        age: 18
      }
    }

    // 通过JSON解析，也可以实现深拷贝
    let copy = JSON.parse(JSON.stringify(oObj))
    copy.hobbies.push('跳舞')
    console.log(oObj)
    console.log(copy)
```

![deepCopy](/styles/images/javascript/copy/copy-02.png)

## 四、jQuery.extend()